# CA2 Part 2: Technical Report

<!-- TOC -->
* [CA2 Part 2: Technical Report](#ca2-part-2-technical-report)
  * [Goals](#goals)
  * [Step-by-Step tutorial](#step-by-step-tutorial)
  * [Alternatives to Gradle](#alternatives-to-gradle)
      * [Gradle and Maven differences](#gradle-and-maven-differences)
      * [Step-by-step](#step-by-step)
* [Author](#author)
<!-- TOC -->

## Goals

The goal of Part 2 of this assignment is to convert the basic version of the Tutorial application, used in the CA1, from Maven to **Gradle**.

## Step-by-Step tutorial

1. **Create Branch:** Create a new branch named `tut-basic-gradle` for this part of the assignment. You can create it like this:
   ```bash
   git checkout -b tut-basic-gradle
   ```
2. **Update the .gitignore file**: Please check if you need to update your gitignore file. We don't need to track the node and the node_modules files, so if they're not included, please add something among these lines:
    ```gitignore
    /CA2/Part2/node_modules/
    /CA2/Part2/node/
    ```
3. **Setup Spring Boot Project:** Use [https://start.spring.io](https://start.spring.io) to start a new Gradle Spring Boot project with the following dependencies: **Rest Repositories, Thymeleaf, JPA, and H2.** Extract the generated zip file into the folder `CA2/Part2/` of the repository.
4. **Copy Source Code:** Delete the `src` folder and copy the code from the **Part 1** basic tutorial's `src` folder into the new project.
5. **Copy Additional Files:** Copy the files `webpack.config.js` and `package.json` from the basic tutorial. Be careful to place it in the root folder, alongside files such as **build.gradle.**
6. **Delete Generated Folder:** Delete the folder `src/main/resources/static/built/` as it should be generated from JavaScript by the webpack tool.
7. **Fix javax dependency at Employee.java**: At the file `Employee.java`, on the copied files, you need to fix the javax dependencies to jakarta.
    ```java
    import jakarta.persistence.Entity;
    import jakarta.persistence.GeneratedValue;
    import jakarta.persistence.Id;
    ```
8. **Experiment and Test:** Experiment with the application by using `./gradlew bootRun`. Please note that the webpage at `http://localhost:8080` is blank at the moment. That's expected!
9. **Add Frontend Plugin:** Add the Gradle plugin `org.siouan.frontend` to manage the frontend code. Configuration details can be found [here](https://github.com/Siouan/frontend-gradle-plugin).
   1. First, add the plugin to **build.gradle** with the following line: `id "org.siouan.frontend-jdk17" version "8.0.0"`
   2. Then, add the following at the end of the **build.gradle** file. 
   ```groovy
   frontend {
    nodeVersion = "20.12.1"
    assembleScript = "run build"
    cleanScript = "run clean"
    checkScript = "run check"
    }
   ```
10. Add the following scripts to the **package.json** file:
     ```json
     "scripts": {
     "webpack": "webpack",
     "build": "npm run webpack",
     "check": "echo Checking frontend",
     "clean": "echo Cleaning frontend",
     "lint": "echo Linting frontend",
     "test": "echo Testing frontend"
     },
     ```
11. **Package Manager configuration:** Add the following line to  `package.json`.
     ```json
     "packageManager": "npm@9.6.7",
     ```
12. **Build and Run:** Execute `./gradlew build` to generate frontend code and `./gradlew bootRun` to run the application.
13. **Add Copy Task:** Add a task to Gradle to copy the generated JAR to a folder named `dist` located at the project root folder level. Here's the example of what I did:
    ```groovy
    tasks.register('copyJar', Copy) {
        description = "Copies the build generated .jar to the dist/ folder."
        group = "DevOps"
    
        dependsOn build
        from jar
        into "${project.rootDir}/dist"
    }
    ```
14. **Add Cleanup Task:** Add a task to Gradle to delete all the files generated by webpack, usually located at `src/main/resources/static/built/`, automatically before the `clean` task. This is my implementation, as an example:
    ```groovy
     tasks.register('cleanWebpack', Delete) {
        description = "Delete all the files generated by webpack. Task is ran automatically before clean task."
        group = "DevOps"

        delete "${project.rootDir}/src/main/resources/static/built"
    }
    
    clean.dependsOn cleanWebpack
    ```
15. **Verify the tasks**: Check the tasks available in the project. It should have both _Delete_ and _Copy_ tasks under the group **DevOps**.
    ```bash
    ./gradlew tasks
    ```
16. **Test and Commit:** Experiment with all developed features (use `./gradlew build` and `./gradlew bootRun`!) and then commit the code. Make sure it works!
17. **Merge the branch**: After making the commit, we need to merge it to the main/master branch. Use `git status` as needed.
    ```bash
    git checkout main
    git merge --no-ff tut-basic-gradle
    ```
18. Now that we've reached the end of this assignment, document it, and mark your repository with the tag `ca2-part2`.
    ```bash
    git tag -a ca2-part1 -m "Completed part2 from CA2"
    git push --tags
    ```
    
## Alternatives to Gradle

The main alternatives to **Gradle** are Maven and Ant. There is, however, some new
alternatives such as Bazel and Saker.build!

For this tutorial, however, I made the alternative with Maven. You can check the final
result by going to the folder Part2_Alternative.

   ```bash
   cd ../Part2_Alternative
   ```

This part is divided in two section: analysis, and implementation steps.

### Gradle and Maven differences

Here are some of the main differences between the two:

**Build Configuration:**

- Gradle: Uses Groovy/Kotlin for build script definition.
- Maven: Relies on XML-based POM files with predefined conventions.

**Flexibility and Customization:**

- Gradle: Offers greater flexibility and extensibility.
- Maven: Follows a convention-over-configuration approach.

**Community and Ecosystem:**

- Gradle: Has a growing community (specially in the mobile community), and ecosystem with
  extensive documentation, plugins, and community-contributed resources.
- Maven: Mature ecosystem with a vast repository of plugins and extensive documentation,
  widely adopted in the Java community.

**Build Automation / Plugins**
Gradle's build automation extensibility is facilitated by its plugin system, which allows
developers to create custom plugins and tasks using Groovy or Kotlin. This approach
enables encapsulation of complex build logic into reusable components and seamless
integration of existing plugins from
the [Gradle Plugin Portal](https://plugins.gradle.org/). In contrast, Maven also offers
plugin-based extensibility through Maven plugins, but its XML-based configurations and
convention-over-configuration approach can make plugin development more verbose and less
flexible than Gradle.

Flexibility, however, does have its pros and cons, so it's important to consider the
option that most suit your needs.

### Step-by-step

1. **Setup Spring Boot Project:** We can also
   use [https://start.spring.io](https://start.spring.io) to start a new Maven Spring Boot
   project with the same dependencies as before: **Rest Repositories, Thymeleaf, JPA, and
   H2.** Extract the generated zip file into the folder `CA2/Part2/` of the repository.
2. **Project setup**: The initial setup works the same as the previous tutorial, from
   steps 4-7: We copy the `src` folder, the `package.json` and `webpack.config.js`, delete
   the `src/main/resources/static/built/`, and fix the imports on the Employee file,
   adding the `jakarta` dependency.
3. **Frontend Plugin**: First, we need to add the frontend plugin to the
   generated `pom.xml` file. It can look something like this - you can modify the node
   version, etc, if you wish.
   ```xml
   <plugin>
        <groupId>com.github.eirslett</groupId>
        <artifactId>frontend-maven-plugin</artifactId>
        <version>1.15.0</version>

        <executions>
            <execution>
                <id>install-node-and-npm</id>
                <goals>
                    <goal>install-node-and-npm</goal>
                </goals>
                <phase>generate-resources</phase>
            </execution>

            <execution>
                <id>npm-install</id>
                <goals>
                    <goal>npm</goal>
                </goals>
                <configuration>
                    <arguments>npm install</arguments>
                </configuration>
            </execution>

            <execution>
                <id>webpack-build</id>
                <goals>
                    <goal>npm</goal>
                </goals>
                <configuration>
                    <arguments>run build</arguments>
                </configuration>
            </execution>
        </executions>

        <configuration>
            <nodeVersion>v8.11.1</nodeVersion>
            <npmVersion>5.6.0</npmVersion>
        </configuration>
    </plugin>
    ```
4. **Copy Task**: We can build our copy task in different ways. Here, in this example,
   the *.jar file is copied to the `/dist` folder whenever a build/run occurs.
    ```xml
   <plugin>
        <groupId>org.apache.maven.plugins</groupId>
        <artifactId>maven-resources-plugin</artifactId>
        <version>3.3.1</version>
        <executions>
            <execution>
                <id>copy-files-on-build</id>
                <phase>package</phase>
                <goals>
                    <goal>copy-resources</goal>
                </goals>
                <configuration>
                    <outputDirectory>${basedir}/dist</outputDirectory>
                    <resources>
                        <resource>
                            <directory>target/</directory>
                            <include>*.jar</include>
                            <filtering>false</filtering>
                        </resource>
                    </resources>
                </configuration>
            </execution>
        </executions>
    </plugin>
    ```
5. **Cleanup Task**: Here is an example of a clean plugin, aiming to remove the contents
   of `/src/main/resources/static/built`.
    ```xml
   <plugin>
        <artifactId>maven-clean-plugin</artifactId>
        <version>3.1.0</version>
        <executions>
            <execution>
                <id>clean-webpack</id>
                <phase>clean</phase>
                <goals>
                    <goal>clean</goal>
                </goals>
                <configuration>
                    <filesets>
                        <fileset>
                            <directory>
                                ${project.basedir}/src/main/resources/static/built
                            </directory>
                            <includes>
                                <include>*</include>
                            </includes>
                        </fileset>
                    </filesets>
                </configuration>
            </execution>
        </executions>
    </plugin>
    ```
6. Everything is now configured. You can run the application, and please verify if
   everything is working properly!

Thank you!

# Author
- [Aline Emily](https://github.com/line-em), 1231866
- Repository: https://github.com/line-em/devops-23-24-JPE-1231866/